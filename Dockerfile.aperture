FROM clojure:temurin-21-tools-deps-jammy
MAINTAINER Marc <xtof@relica.io>

# WORKDIR /usr/src/app/packages_clj/aperture



# COPY ./packages_clj/common /usr/src/app/packages_clj/common
# # Now copy aperture's deps.edn
# COPY ./packages_clj/aperture/deps.edn .
# # Update deps.edn to use the correct path
# # RUN sed -i 's|{:local/root "../common"}|{:local/root "/usr/src/app/packages_clj/common"}|g' deps.edn



# # COPY ./packages_clj/aperture/deps.edn .
# RUN clojure -P  # Download dependencies

# COPY ./packages_clj/aperture .

# EXPOSE 2175

# CMD ["clojure", "-M:dev"]


WORKDIR /usr/src/app

# COPY --from=build /usr/src/app/packages_ts/config/tsconfig.base.json /usr/src/app/packages_ts/config/tsconfig.base.json
# COPY --from=build /usr/src/app/packages_ts/config/tsconfig.lib.json /usr/src/app/packages_ts/config/tsconfig.lib.json

# COPY --from=build /usr/src/app/packages_ts/libs/types/package.json /usr/src/app/packages_ts/libs/types/package.json
# COPY --from=build /usr/src/app/packages_ts/libs/types/dist /usr/src/app/packages_ts/libs/types/dist

# COPY --from=build /usr/src/app/packages_ts/libs/constants/package.json /usr/src/app/packages_ts/libs/constants/package.json
# COPY --from=build /usr/src/app/packages_ts/libs/constants/dist /usr/src/app/packages_ts/libs/constants/dist

COPY packages_clj/common /usr/src/app/packages_clj/common
COPY packages_clj/aperture /usr/src/app/packages_clj/aperture

WORKDIR /usr/src/app/packages_clj/aperture

# Expose both the application and nREPL ports
EXPOSE 2175
EXPOSE 7891

CMD ["clojure", "-M:dev"]
